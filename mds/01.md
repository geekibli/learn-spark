# Spark


## å¿«é€Ÿä¸Šæ‰‹ä¹‹wordCountåŠŸèƒ½å®ç°

![](https://oscimg.oschina.net/oscnet/up-0c64b47d7af8385dab48cc4ac0fc2aa1199.png)

å®ç°wordCounté€»è¾‘å›¾å±•ç¤ºå¦‚ä¸Š ğŸ‘†

**æ­å»ºé¡¹ç›®çš„æ—¶å€™ï¼Œæ‰¾ä¸åˆ°ä¾èµ–çš„è¯ï¼Œå¯ä»¥åˆ°è¿™ä¸ªç½‘ç«™å»ä¸‹è½½**
``https://search.maven.org``  

å®Œæ•´ä»£ç å¯ä»¥æŸ¥çœ‹ä¸‹é¢ ğŸ‘‡  
`com.ibli.spark.core.wc.Spark01_WordCount`


å¦ä¸€ç§wordCountçš„å†™æ³•  
![](https://oscimg.oschina.net/oscnet/up-c8ab6d09a7417d8d85b662f553964c4a3a1.png)  

å®Œæ•´ä»£ç å¯ä»¥æŸ¥çœ‹ä¸‹é¢ ğŸ‘‡  
`com.ibli.spark.core.wc.Spark02_WordCount`  

ä½¿ç”¨Sparkæä¾›çš„æ–¹æ³•å®ç°wordCount  

å®Œæ•´ä»£ç å¯ä»¥æŸ¥çœ‹ä¸‹é¢ ğŸ‘‡  
`com.ibli.spark.core.wc.Spark03_WordCount`


## ä½¿ç”¨spark-shellè®¡ç®—wordCount

### è¿›å…¥åˆ°sparkå®‰è£…ç›®å½•çš„binè·¯å¾„ä¸‹ï¼Œæ‰§è¡Œä¸€ä¸‹å‘½ä»¤ï¼š

```
sh spark-shell start
```
å‡ºç°å¦‚ä¸‹åˆ™å¯åŠ¨æˆåŠŸï¼š 

<img src="https://oscimg.oschina.net/oscnet/up-cd7305f89679f6dbc7e337a14f46ed459b8.png" width="600" height="350">

ç„¶åå‡†å¤‡ä¸€ä¸ªæ–‡ä»¶ï¼Œè·¯å¾„å’Œå†…å®¹å¦‚ä¸‹æ‰€ç¤ºï¼š

```shell script
gaolei@gaolei data % pwd
/usr/local/spark/data
gaolei@gaolei data % ls
graphx    mllib     streaming word.txt
gaolei@gaolei data % cat word.txt 
hello java
hello scala
hello spark
gaolei@gaolei data % 
```

ç„¶ååœ¨spark-shellæ¨¡å¼ä¸‹ï¼Œè¾“å…¥ä¸€ä¸‹ä»£ç ï¼š

```scala 3
sc.textFile("../data/word.txt").flatMap(_.split(" ")).map((_,1)).reduceByKey(_+_).collect
```

æ˜¾ç¤ºå¦‚ä¸‹é¢ï¼š 

<img src="https://oscimg.oschina.net/oscnet/up-d656cf3da6b5bec7c95b9f59a9ea538328e.png" width="600" height="340">


**è§†é¢‘é“¾æ¥**ï¼š https://www.bilibili.com/video/BV11A411L7CK?p=11&spm_id_from=333.1007.top_right_bar_window_history.content.click



## ä»»åŠ¡ç›‘æ§UI

å› ä¸ºæ˜¯åœ¨æœ¬åœ°èµ·çš„sparkå®ä¾‹ï¼Œè¿™é‡Œç›´æ¥è®¿é—®æœ¬åœ°çš„4040ç«¯å£ï¼š

<img src="https://oscimg.oschina.net/oscnet/up-4e7abfaf0bee923da6c5ee6140f90845177.png" height="630" width="490">

è¿˜å¯ä»¥æŸ¥çœ‹jobçš„è¯¦ç»†æ‰§è¡Œä¿¡æ¯: 

<img src="https://oscimg.oschina.net/oscnet/up-86f501a1031cf0711d5abf177c6300cd411.png" width="630" height="490">


## é€šè¿‡ spark-submitæäº¤job

```scala 3
sudo sh spark-submit \
--class org.apache.spark.examples.SparkPi \
--master local[2] \
../examples/jars/spark/spark-examples_2.12-3.0.0-preview2.jar \
5
```
è¿è¡Œç»“æœï¼š  

<img src="https://oscimg.oschina.net/oscnet/up-d719b7748a5561027c40b6b20c4e39f44cd.png" width="630" height="490"> 

**è§†é¢‘é“¾æ¥: ** https://www.bilibili.com/video/BV11A411L7CK?p=12&spm_id_from=pageDriver


## Spark standaloneæ¨¡å¼

### ä¿®æ”¹ slaves.template
```scala 3
mv slaves.template slaves
vim slaves
```
æ·»åŠ workerèŠ‚ç‚¹
```scala 3
node1
node2
node3
```

### ä¿®æ”¹spark-env.template
åŒæ ·å»æ‰template
ç„¶åç¼–è¾‘æ–‡ä»¶ï¼Œæ·»åŠ å¦‚ä¸‹é…ç½®ï¼Œ

```shell script
export JAVA_HOME=/Library/Java/JavaVirtualMachines/jdk1.8.0_221.jdk/Contents/Home
export SPARK_MASTER_HOST=node1
export SPARK_MASTER_PORT=7077
```

æŸ¥çœ‹JAVA_HOME : `echo $JAVA_HOME`

> åœ¨node2 node3æœåŠ¡å™¨ä¸Šåšç›¸åŒå¯¹åº”é…ç½®ç„¶åï¼Œå¯åŠ¨é›†ç¾¤
>

```shell script
cd sbin
./start-all.sh
```

### æŸ¥çœ‹master UIç›‘æ§é¡µé¢

<img src="https://oscimg.oschina.net/oscnet/up-79b2a79855f1fbea46ad28da775f6a3b5c6.png" width="600" height="340">

ç„¶åå‘é›†ç¾¤ä¸­æäº¤ä»»åŠ¡çš„å‘½ä»¤å¦‚ä¸‹ï¼š

```scala 3
sudo sh spark-submit \
--class org.apache.spark.examples.SparkPi \
--master spark://node1:7077 \
../examples/jars/spark/spark-examples_2.12-3.0.0-preview2.jar \
5
```

æ‰§è¡Œç»“æœå’Œä¸Šé¢ä¸€æ ·ã€‚  

**è§†é¢‘åœ°å€: ** https://www.bilibili.com/video/BV11A411L7CK?p=13



